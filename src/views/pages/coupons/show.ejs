<section>
  <div class="bg-white rounded shadow-sm p-4 my-3">
    <div class="d-flex gap-3 align-items-center">
      <div class="col">
        <h4 class="fw-bold">
          Coupon Detail
        </h4>
      </div>
      <div class="mt-3">
        <button id="deleteBtn" class="btn btn-danger btn-sm">
          <i class="bi bi-trash"></i>
          Delete
        </button>
        <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#updateModal">
          <i class="bi bi-pencil-square"></i>
          Update
        </button>
      </div>
    </div>

    <div class="px-4">
      <h5>
        Coupon Code: <%= data.coupon_code %>
      </h5>
      <% const options={weekday: 'long' , day: 'numeric' , month: 'long' , year: 'numeric' } %>
        <h6>
          Expired:
          <span class="text-success">
            <%= data.coupon_end.toLocaleDateString('id-ID', options) %>
          </span>
        </h6>
        <h6>
          Discount: <%= data.discount %>
        </h6>
        <h6>
          Minimum Price: <%= data.minimum_price %>
        </h6>
    </div>

  </div>

  <!-- UPDATE MODAL -->
  <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Update Coupon</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <form id="form" action="/admin/coupons">
          <div class="modal-body">
            <div class="form-floating mb-3">
              <input type="text" name="coupon_code" class="form-control" placeholder="John Doe" autocomplete="off"
                required value="<%= data.coupon_code %>">
              <label>Coupon Code</label>
            </div>
            <div class="d-flex mb-3">
              <div class="form-floating col">
                <input name="start_date" type="date" value="<%= data.coupon_start.toISOString().substr(0, 10) %>"
                  class="form-control" placeholder="date" autocomplete="off" required>
                <label>Start Date</label>
              </div>
              <div class="form-floating col">
                <input name="end_date" type="date" value="<%= data.coupon_end.toISOString().substr(0, 10) %>"
                  class="form-control" placeholder="date" autocomplete="off" required>
                <label>End Date</label>
              </div>
            </div>
            <div class="form-floating mb-3">
              <input type="number" value="<%= data.quota %>" name="quota" class="form-control" placeholder="John Doe"
                autocomplete="off" required>
              <label>Quota</label>
            </div>
            <div class="form-floating mb-3">
              <input type="hidden" value="<%= data.discount %>" id="discount" name="discount">
              <input id="discountDisplay" value="<%= new Intl.NumberFormat('id-ID').format(data.discount) %>"
                type="text" onkeyup="formatDiscount(this.value)" class="form-control" placeholder="John Doe"
                autocomplete="off" required>
              <label>Discount Price</label>
            </div>
            <div class="form-floating mb-3">
              <input type="hidden" id="price" value="<%= data.minimum_price %>" name="minimum_price">
              <input id="priceDisplay" value="<%= new Intl.NumberFormat('id-ID').format(data.minimum_price) %>"
                type="text" onkeyup="formatMinimumPrice(this.value)" class="form-control" placeholder="John Doe"
                autocomplete="off" required>
              <label>Minimum Price</label>
            </div>
            <p class="mb-2 mx-2">Categories:</p>
            <div class="mb-3 mx-2 d-flex gap-3">
              <div>
                <input name="coding" class="form-check-input" type="checkbox" id="coding"> <label
                  for="coding">Coding</label>
                <br>
                <input name="robotic" class="form-check-input" type="checkbox" id="robotic"> <label
                  for="robotic">Robotic</label> <br>
                <input name="app_programming" class="form-check-input" type="checkbox" id="app"> <label for="app">App
                  Programming</label> <br>
              </div>
              <div>
                <input name="engineering" class="form-check-input" type="checkbox" id="engineering"> <label
                  for="engineering">Engineering</label> <br>
                <input name="coding_bootcamp" class="form-check-input" type="checkbox" id="bootcamp"> <label
                  for="bootcamp">Coding Bootcamp</label>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-md btn-success">Save</button>
          </div>
        </form>

      </div>
    </div>
  </div>
  <!-- END UPDATE MODAL -->

</section>

<script>
  $('#deleteBtn').on('click', function () {
    swal({
      title: "Are you sure?",
      text: '<%= "Contoh Coupon" %> will be deleted', icon: "warning", buttons: true, dangerMode: true,
    }).then((confirm) => {
      if (confirm) {
        $.ajax({
          url: 'http://localhost:3000/admin/coupons/delete/<%= "contoh-coupon" %>',
          type: 'DELETE',
          success: function (result) {
            swal({
              title: 'Success!',
              text: 'Coupon Deleted',
              icon: 'success',
            }).then((result) => {
              window.location.href = '/admin/coupons'
            })
          },
          error: function (err) {
            swal({
              title: 'Error!',
              text: 'An error occured',
              icon: 'error'
            })
          }
        })
      }
    })
  })

  $('#formEdit').on('submit', function (e) {
    e.preventDefault()
    $.ajax({
      url: $(this).attr('action'),
      type: 'PUT',
      data: $(this).serialize(),
      success: function (result) {
        swal({
          title: 'Success!',
          text: 'Coupon Updated',
          icon: 'success',
        }).then((result) => {
          window.location.href = '/admin/coupons/show/<%= "contoh-coupon" %>'
        })
      },
      error: function (err) {
        swal({
          title: 'Error!',
          text: 'An error occured',
          icon: 'error'
        })
      }
    })
  })

</script>