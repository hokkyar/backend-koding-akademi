<section class="section">

  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Manage Events</h5>
          <a href="/admin/events/add" class="btn btn-sm btn-success mb-3">
            <i class="bi bi-calendar-event"></i>
            Add Event
          </a>
          <table id="myTable" class="hover row-border cell-border">
            <thead>
              <tr>
                <th>#</th>
                <th>Event Name</th>
                <th>Price</th>
                <th>Quota</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% for (let i=0; i < data.length; i++) { %>
                <tr>
                  <td>
                    <%= i + 1 %>
                  </td>
                  <td>
                    <%= data[i].name %>
                  </td>
                  <td style="min-width: 150px;">
                    Rp <%= new Intl.NumberFormat('id-ID').format(data[i].price) %>
                  </td>
                  <td>
                    <span class="text-primary">
                      <%= (data[i].participants) ? data[i].participants : 0 %>
                    </span>/<span class="text-success">
                      <%= data[i].quota %>
                    </span>
                  </td>
                  <td>
                    <div class="d-flex gap-2">
                      <a style="cursor: pointer;" class="text-primary" href="/admin/events/show/<%= data[i].id %>"
                        data-bs-toggle="tooltip" data-bs-title="Show">
                        <i class="bi bi-info-circle-fill fs-5"></i>
                      </a>
                      <a href="/admin/events/edit/<%= data[i].id %>" style="cursor: pointer;"
                        class="text-warning editBtn" data-bs-toggle="tooltip" data-bs-title="Update">
                        <i data-bs-toggle="modal" data-bs-target="#updateModal" class="bi bi-pencil-fill fs-5"></i>
                      </a>
                      <a style="cursor: pointer;" class="text-danger deleteEvent" data-bs-toggle="tooltip"
                        data-bs-title="Delete" data-event="<%= JSON.stringify(data[i]) %>">
                        <i class="bi bi-trash-fill fs-5"></i>
                      </a>
                    </div>
                  </td>
                </tr>
                <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  $('.deleteEvent').on('click', function () {
    const data = $(this).data('event')
    swal({
      title: "Are you sure?",
      text: `${data.name} will be deleted`,
      icon: "warning",
      buttons: true,
      dangerMode: true,
    })
      .then((confirm) => {
        if (confirm) {
          $.ajax({
            url: `https://kodingapp.refillaja.id/admin/events/delete/${data.id}`,
            type: 'DELETE',
            success: function (result) {
              swal({
                title: 'Success!',
                text: 'Event Deleted',
                icon: 'success',
              }).then((result) => {
                window.location.href = '/admin/events'
              })
            },
            error: function (err) {
              swal({
                title: 'Error!',
                text: 'An error occured',
                icon: 'error'
              })
            }
          })
        }
      })
  })
</script>